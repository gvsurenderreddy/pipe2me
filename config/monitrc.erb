<%
  def which(name)
    `which #{name}`.chomp
  end

  def log(process)
    # "#{ROOT}/var/log/#{process}.log"
    "#{ROOT}/var/log/pipe2me.log"
  end

  bundle = "#{ROOT}/script/bundle"
  var = "#{ROOT}/var"
%>

set daemon 10
set httpd port 5500 and use address localhost allow localhost

check process web with pidfile <%= var %>/pids/web.pid
  start program = "<%= which :daemon %> -N --name web --pidfiles <%= var %>/pids --output <%= log :web %> -- <%= bundle %> exec puma -b unix:<%= var %>/web.sock" with timeout 60 seconds
  stop program = "<%= which :daemon %> -N --name web --pidfiles <%= var %>/pids --output <%= log :web %> --stop"

check process sshd with pidfile <%= var %>/pids/sshd.pid
  start program = "<%= which :daemon %> -N --name sshd --pidfiles <%= var %>/pids --output <%= log :sshd %> -- <%= which :sshd %> -D -e -f <%= var %>/config/sshd.conf" with timeout 60 seconds
  stop program = "<%= which :daemon %> -N --name sshd --pidfiles <%= var %>/pids --output <%= log :sshd %> --stop"

check process nginx with pidfile <%= var %>/pids/nginx.pid
  start program = "<%= which :daemon %> -N --name nginx --pidfiles <%= var %>/pids --output <%= log :nginx %> -- <%= which :nginx %> -c <%= var %>/config/nginx.conf " with timeout 60 seconds
  stop program = "<%= which :daemon %> -N --name nginx --pidfiles <%= var %>/pids --output <%= log :nginx %> --stop"
